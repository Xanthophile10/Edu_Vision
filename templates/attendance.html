<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Attendance Dashboard</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f4f6f8;
            padding: 20px;
        }

        h2 {
            margin-bottom: 20px;
            font-weight: 600;
            color: #2c3e50;
        }

        .card {
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            background: #fff;
        }

        table th {
            background-color: #2c3e50 !important;
            color: #fff !important;
        }

        tr:hover {
            background-color: #e9f5ff;
        }

        img {
            width: 70px;
            height: 70px;
            object-fit: cover;
            border-radius: 6px;
            border: 1px solid #ccc;
            transition: transform 0.2s;
        }

        img:hover {
            transform: scale(1.2);
        }

        .present {
            color: green;
            font-weight: bold;
        }

        .unknown {
            color: red;
            font-weight: bold;
        }

        .toolbar {
            margin-bottom: 20px;
        }

        .toolbar a {
            text-decoration: none;
            background: #3498db;
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            margin-right: 5px;
            font-size: 14px;
            transition: background 0.2s;
        }

        .toolbar a:hover {
            background: #2980b9;
        }

        .filter-select {
            max-width: 200px;
        }
    </style>
</head>
<body>

<div class="card">
    <h2>üìä Attendance Dashboard</h2>

    <div class="toolbar d-flex flex-wrap align-items-center mb-3">
        <a href="{{ url_for('index') }}">üè† Dashboard</a>
        <a href="{{ url_for('manage_registered_students') }}">üë• Manage Students</a>
        <a href="{{ url_for('recognize') }}">üì∑ Live Recognition</a>

        <select class="form-select filter-select ms-auto" id="statusFilter">
            <option value="All" selected>Filter by Status</option>
            <option value="Present">Present ‚úÖ</option>
            <option value="Unknown">Unknown ‚ùì</option>
        </select>
    </div>

    <div class="table-responsive">
        <table class="table table-striped table-hover align-middle text-center">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Student ID</th>
                    <th>Name</th>
                    <th>Course</th>
                    <th>Time In</th>
                    <th>Score</th>
                    <th>Status</th>
                    <th>Snapshot</th>
                </tr>
            </thead>
            <tbody id="attendanceTable">
                {% for row in attendance %}
                <tr data-status="{{ row[6] }}">
                    <td>{{ row[0] }}</td>

                    {% if row[1] != "Unknown" %}
                        <td>{{ row[1] }}</td>
                        <td>{{ row[2] }}</td>
                        <td>{{ row[3] }}</td>
                    {% else %}
                        <td colspan="3" class="unknown">Unknown</td>
                    {% endif %}

                    <td>{{ row[4] }}</td>
                    <td>{{ "%.2f"|format(row[5]|float) }}</td>

                    {% if row[6] == "Present" %}
                        <td class="present">Present ‚úÖ</td>
                    {% else %}
                        <td class="unknown">Unknown ‚ùì</td>
                    {% endif %}

                    <td>
                        {% if row[7] %}
                            <img src="{{ url_for('face_snapshot', filename=row[7]) }}" title="Click to enlarge">
                        {% else %}
                            -
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Bootstrap JS + Optional JS for filter -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const filterSelect = document.getElementById('statusFilter');
    const tableRows = document.querySelectorAll('#attendanceTable tr');

    filterSelect.addEventListener('change', () => {
        const selected = filterSelect.value;

        tableRows.forEach(row => {
            if(selected === "All") {
                row.style.display = '';
            } else {
                row.style.display = (row.dataset.status === selected) ? '' : 'none';
            }
        });
    });
</script>

</body>
</html>
